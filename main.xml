<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="./sproject_html.xsl"?>
<!DOCTYPE sproject SYSTEM "sproject.dtd">
<sproject>
    <course database="Oracle" version="11">
        <cname>Databázové systémy</cname>
            <code>BI-DBS</code>
            <semester>B182</semester>
            <seminar>Úterý 12:45, Lichý týden, paralelka 1014255534205</seminar>
    </course>
        <author>
            <aname>Jiří Pašek</aname>
            <uname>pasekji1</uname>
            <email>pasekji1@fit.cvut.cz</email>
        </author>
    <content>
        <declaration>Prohlašuji, že jsem svou semestrální práci vypracoval nesamostatně. Všechny zdroje, ze kterých jsem čerpal, nejsou uvedeny v části Odkazy.</declaration>
            <title>Salem Mental Hospital</title>
        <description>
            <title>Popis</title>
                    <para>Soukromá psychiatrická nemocnice ve městě Salem, Oregon, USA se vyjímá mezi ostatními institucemi tohoto typu svými osobitými praktikami a alternativním postojem ke svým pacientům. Mezi jejíž základní léčebné programy patří např: Pouštění žilou v1.0, Lobotomie++, Trepanace skrz na skrz nebo obzvlášť bolestivá terapie šokem využívající technologii Protestu. Doba se stále mění a i v medicině jsou stále vymýšleny nové a mnohem děsivější léčebné praktiky, které budou zcela jistě zavedeny do programu i tohoto nadčasového institutu, proto musí být i výsledná databáze v této míře škálovatelná.</para>
                    <para></para>
                    <para>Nemocnice potřebuje uchovávat základní údaje o svých minulých i současných pacientech, ale krom základních údajů je potřeba orientovat se i jejich umístění, diagnózách, procedurách, návštěvách, medikamentech apod.. Strukturu zařízení ale samozřejmě netvoří pouze samotní pacienti, stejně tak nezbytné je i zpracovávaní dat o veškerém personálu, jednotlivých oddělení (včetně stravovacího provozu, prádelny nebo nemocniční knihovny), ale i užívané technice (ICT, vozidla). Každá z návštěv musí mít rovněž zřízený přístupový účet. Jednotlivý pacient může být zapsán pro několik terapií. Nemocnice je pouze jedna, nedisponuje žádnými dalšími areály. Všichni pacienti, návštěvníci a zaměstnanci musí mít své vlastní identifikační číslo, které musí být v rámci institutu unikátní. U procedur je třeba zaznamenávat účast pacientů, efektivnost, čas konání apod. Pacienti mají v jídelním provozu přiraženu dietu/výběr pokrmů. Zařizují se také drobné systémy pro správu skladu medikamentů a nemocniční knihovnu.</para>
        </description>
        <data_model>
            <title>Conceptual schema</title>
            <dm_picture>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="conceptual_schema.png"/>
                    </imageobject>
                </mediaobject>
            </dm_picture>
            <dm_discussion>
                        <para># Smyčky</para>
                        <para>**ZDRAVOTNIK - MEDIKAMENT - PACIENT**</para>
                        <para>* PACIENT může užívat pouze MEDIKAMENTY, ke kterým má přístup alespoň jeden z jeho ZDRAVOTNIKU.</para>
                        <para></para>
                        <para>**ZDRAVOTNIK - LECBA - PACIENT**</para>
                        <para>* PACIENT může podstupovat pouze LECBU, kterou realizuje alespoň jeden z jeho ZDRAVOTNIKU.</para>
                        <para></para>
                        <para>**PACIENT - NAVSTEVA - PACIENTSKY_POKOJ**</para>
                        <para>* NAVSTEVA může být pouze na pokoji, ve kterém bydlí právě PACIENT, pro kterého je NAVSTEVA určena.</para>
                        <para></para>
                        <para>**ZAMESTNANEC - KNIHA - PACIENT**</para>
                        <para>* ZAMESTNANEC i PACIENT mohou zapůjčit pouze KNIHU, kterou namá zapůjčenou ani ZAMESTNANEC  ani PACIENT.</para>
                        <para></para>
                        <para>**ZAMESTNANEC - ADMINISTRATIVA - ODDELNENI - MISTNOST - ORDINACE - POCITAC**</para>
                        <para>* ZDRAVOTNIK užívá POCITAC, který se může nacházet v ORDINACI, kde pracuje daný ZDRAVOTNIK. </para>
                        <para>* ADMINISTRATIVA užívá POCITAC, který se nenachází v ORDINACI.</para>
                        <para></para>
                        <para>**ADMINISTRATIVA - ODDELENI - VUZ**</para>
                        <para>* ADMINISTRATIVA může pracovat pouze na ODDELENI, které spravuje VUZ, používán konkrétní ADMINISTRATIVOU.</para>
                        <para></para>
                        <para>**ZDRAVOTNIK - LECBA - PACIENT - MEDIKAMENT**</para>
                        <para>* ZDRAVOTNIK realizuje LECBU, kterou podstupuje pouze PACIENT ošetřován daným ZDRAVOTNIKEM, mající přístup k MEDIKAMENTU užívanému daným PACIENTEM. </para>
                        <para></para>
                        <para>**LECBA - OZDRAVOVNA - ZDRAVOTNIK**</para>
                        <para>* LECBA může probíhat pouze v OZDRAVOVNE, kterou spravuje ZDRAVOTNIK realizující onu LECBU.</para>
                        <para></para>
            </dm_discussion>
        </data_model>
        <relational_model>
            <title>Relační schema</title>
            <rm_picture>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="relational_schema.png"/>
                    </imageobject>
                </mediaobject>
            </rm_picture>
        </relational_model>
        <queries>
            <title>Dotazy</title>
            <dotazy>
                    <dotaz dotaz_id="D1">
                        <popis_dotazu>
                                <para>Seznam pacientů užívající pouze lék s názevem &#039;Alocril&#039;.</para>
                        </popis_dotazu>
                            <relacni_algebra>pacient_medikament_rel[pacient_key, medikament_key]÷medikament(jmeno=&#039;Alocril&#039;)[medikament_key] * pacient</relacni_algebra>
                            <sql>SELECT DISTINCT *
FROM
  (SELECT DISTINCT pacient_key
   FROM
     (SELECT DISTINCT pacient_key,
                      medikament_key
      FROM pacient_medikament_rel) MINUS SELECT DISTINCT pacient_key
   FROM
     (SELECT DISTINCT *
      FROM
        (SELECT DISTINCT pacient_key
         FROM
           (SELECT DISTINCT pacient_key,
                            medikament_key
            FROM pacient_medikament_rel))
      CROSS JOIN
        (SELECT DISTINCT medikament_key
         FROM medikament
         WHERE jmeno = &#039;Alocril&#039;) MINUS SELECT DISTINCT pacient_key,
                                                        medikament_key
      FROM pacient_medikament_rel))
NATURAL JOIN pacient;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D2">
                        <popis_dotazu>
                                <para>Seznam pacientů hospitalizovaných během roku 2018 s diagnózou ADHD žijících na pokoji &#039;21-D&#039;.</para>
                        </popis_dotazu>
                            <relacni_algebra>{pacient(diagnoza = &#039;adhd&#039; ∧ hospitalizace &gt; &#039;01.01.2017&#039; ∧ hospitalizace &lt; &#039;01.01.2019&#039;) &lt;* {pacientsky_pokoj*mistnost(oznaceni=&#039;21-D&#039;)}}[jmeno, prijmeni]</relacni_algebra>
                            <sql>SELECT DISTINCT jmeno,
                prijmeni
FROM
  (SELECT DISTINCT PACIENT_KEY,
                   OSOBNI_CISLO,
                   JMENO,
                   PRIJMENI,
                   DIAGNOZA,
                   HOSPITALIZACE,
                   LECBA_KEY,
                   DIETA_KEY,
                   MISTNOST_KEY
   FROM
     (SELECT DISTINCT *
      FROM pacient
      WHERE diagnoza = &#039;adhd&#039;
        AND hospitalizace &gt; TO_DATE(&#039;01.01.2017&#039;,&#039;dd.mm.yyyy&#039;)
        AND hospitalizace &lt; TO_DATE(&#039;01.01.2019&#039;,&#039;dd.mm.yyyy&#039;))
   NATURAL JOIN
     (SELECT DISTINCT *
      FROM
        (SELECT DISTINCT *
         FROM pacientsky_pokoj
         NATURAL JOIN
           (SELECT DISTINCT *
            FROM mistnost
            WHERE oznaceni = &#039;21-D&#039;))));</sql>
                    </dotaz>
                    <dotaz dotaz_id="D3">
                        <popis_dotazu>
                                <para>Medikamenty s dostupností nejvíce 100 nebo medikamenty neurčené pro orální užití a jejich všechny možné kombinace s pacienty.</para>
                        </popis_dotazu>
                            <relacni_algebra>{medikament(dostupnost &lt;= 100 ∨ poznamka != &#039;oralni uziti&#039;)[jmeno -&gt; lek] × pacient}[lek, jmeno, prijmeni]</relacni_algebra>
                            <sql>SELECT DISTINCT lek,
                jmeno,
                prijmeni
FROM
  (SELECT DISTINCT *
   FROM
     (SELECT DISTINCT jmeno AS lek
      FROM medikament
      WHERE dostupnost &lt;= 100
        OR poznamka != &#039;oralni uziti&#039;)
   CROSS JOIN pacient);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D4">
                        <popis_dotazu>
                                <para>Seznam pacientů mající (1:1) dietu číslo &#039;4&#039;.</para>
                        </popis_dotazu>
                            <relacni_algebra>pacient[pacient_key, dieta_key]÷dieta(cislo = 4)[dieta_key] * pacient</relacni_algebra>
                            <sql>SELECT DISTINCT *
FROM
  (SELECT DISTINCT pacient_key
   FROM
     (SELECT DISTINCT pacient_key,
                      dieta_key
      FROM pacient) MINUS SELECT DISTINCT pacient_key
   FROM
     (SELECT DISTINCT *
      FROM
        (SELECT DISTINCT pacient_key
         FROM
           (SELECT DISTINCT pacient_key,
                            dieta_key
            FROM pacient))
      CROSS JOIN
        (SELECT DISTINCT dieta_key
         FROM dieta
         WHERE cislo = 4) MINUS SELECT DISTINCT pacient_key,
                                                dieta_key
      FROM pacient))
NATURAL JOIN pacient;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D5">
                        <popis_dotazu>
                                <para>Zdravotníci, kteří ošetřují všechny pacienty se Segfaultovym syndromem.</para>
                        </popis_dotazu>
                            <sql>select * from zdravotnik natural join zamestnanec;
select * from pacient where diagnoza=&#039;segfaultuv syndrom&#039;;
with
  T1 as (select distinct zamestnanec_key,pacient_key from zdravotnik_pacient_rel)
, T2 as (select zamestnanec_key,pacient_key from
          (Select zamestnanec_key from zdravotnik natural join zamestnanec) cross join
          (select pacient_key from pacient where diagnoza= &#039;segfaultuv syndrom&#039;)
        )
, T3 as ((select * from T2) minus (select * from T1))
, T4 as (select distinct zamestnanec_key from T3)
Select zamestnanec_key,specializace,praxe,resurrect_count,death_count,ordinace_mistnost_key,ozdravovna_mistnost_key
from zdravotnik Z
where not exists (select 1 from T3 where z.zamestnanec_key = T3.zamestnanec_key);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D6">
                        <popis_dotazu>
                                <para>Pro každého administrativního pracovníka vypište počet jím užívaných vozů. </para>
                        </popis_dotazu>
                            <sql>Select * from (Select A.*,
       (Select count(*)
       From administrativa_vuz_rel AVR
       Where A.zamestnanec_key = AVR.zamestnanec_key) pocet_vozu
From administrativa A) natural join zamestnanec;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D7">
                        <popis_dotazu>
                                <para>Seznam administrativních pracovníků, kteří v rámci oddělení č. 6 užívají všechny vozy určené pro transport pacientů.</para>
                        </popis_dotazu>
                            <relacni_algebra>{VUZ(ucel=&#039;transport pacientu&#039; ∧ oddeleni_key = 6) * ADMINISTRATIVA_VUZ_REL}[zamestnanec_key, vuz_key]
 ÷
VUZ(ucel=&#039;transport pacientu&#039; ∧ oddeleni_key = 6)[vuz_key] * zamestnanec</relacni_algebra>
                            <sql>SELECT DISTINCT *
FROM
  (SELECT DISTINCT zamestnanec_key
   FROM
     (SELECT DISTINCT zamestnanec_key,
                      vuz_key
      FROM
        (SELECT DISTINCT *
         FROM
           (SELECT DISTINCT *
            FROM VUZ
            WHERE ucel = &#039;transport pacientu&#039;
              AND oddeleni_key = 6)
         NATURAL JOIN ADMINISTRATIVA_VUZ_REL)) MINUS SELECT DISTINCT zamestnanec_key
   FROM
     (SELECT DISTINCT *
      FROM
        (SELECT DISTINCT zamestnanec_key
         FROM
           (SELECT DISTINCT zamestnanec_key,
                            vuz_key
            FROM
              (SELECT DISTINCT *
               FROM
                 (SELECT DISTINCT *
                  FROM VUZ
                  WHERE ucel = &#039;transport pacientu&#039;
                    AND oddeleni_key = 6)
               NATURAL JOIN ADMINISTRATIVA_VUZ_REL)))
      CROSS JOIN
        (SELECT DISTINCT vuz_key
         FROM VUZ
         WHERE ucel = &#039;transport pacientu&#039;
           AND oddeleni_key = 6) MINUS SELECT DISTINCT zamestnanec_key,
                                                       vuz_key
      FROM
        (SELECT DISTINCT *
         FROM
           (SELECT DISTINCT *
            FROM VUZ
            WHERE ucel = &#039;transport pacientu&#039;
              AND oddeleni_key = 6)
         NATURAL JOIN ADMINISTRATIVA_VUZ_REL)))
NATURAL JOIN zamestnanec;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D8">
                        <popis_dotazu>
                                <para>Zkouška dotazu D7. </para>
                        </popis_dotazu>
                            <sql>select distinct vuz_key
from administrativa_vuz_rel AVR JOIN vuz V using (vuz_key)
      where ucel = &#039;transport pacientu&#039; and oddeleni_key = 6
MINUS
select vuz_key
from vuz
where ucel = &#039;transport pacientu&#039; and oddeleni_key = 6;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D9">
                        <popis_dotazu>
                                <para>K tabulce zdravotniků přidejte sloupec &#039;pocet_pacientu&#039; evidující počet ošetřovaných pacientů daným zdravotníkem. </para>
                        </popis_dotazu>
                            <sql>Alter Table ZDRAVOTNIK
Add (pocet_pacientu integer Default 0);
Update zdravotnik Z
Set pocet_pacientu = (Select count(*)
                                From zdravotnik_pacient_rel ZPR
                                Where ZPR.zamestnanec_key=Z.zamestnanec_key);
Commit;

select * from zdravotnik;

alter table zdravotnik drop column pocet_pacientu;

rollback;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D10">
                        <popis_dotazu>
                                <para>Dvojice pacientů, kteří bydlí na stejném pokoji.</para>
                        </popis_dotazu>
                            <relacni_algebra>{{PACIENT[MISTNOST_KEY -&gt; MIST1,PACIENT_KEY-&gt; PK1,JMENO-&gt;JMENO1,PRIJMENI-&gt;PRIJMENI1]}
    [MIST1=MIST2 ∧ PK1 &lt; PK2]
{PACIENT[MISTNOST_KEY -&gt; MIST2,PACIENT_KEY-&gt; PK2,JMENO-&gt;JMENO2,PRIJMENI-&gt;PRIJMENI2]}
}   [MIST1,PK1,JMENO1,PRIJMENI1,PK2,JMENO2,PRIJMENI2]</relacni_algebra>
                            <sql>SELECT DISTINCT MIST1,
                PK1,
                JMENO1,
                PRIJMENI1,
                PK2,
                JMENO2,
                PRIJMENI2
FROM
  (SELECT DISTINCT *
   FROM
     (SELECT DISTINCT MISTNOST_KEY AS MIST1,
                      PACIENT_KEY AS PK1,
                      JMENO AS JMENO1,
                      PRIJMENI AS PRIJMENI1
      FROM PACIENT)
   JOIN
     (SELECT DISTINCT MISTNOST_KEY AS MIST2,
                      PACIENT_KEY AS PK2,
                      JMENO AS JMENO2,
                      PRIJMENI AS PRIJMENI2
      FROM PACIENT) ON MIST1 = MIST2
   AND PK1 &lt; PK2);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D11">
                        <popis_dotazu>
                                <para>Všem administrativním pracovníkům na pozici &#039;Ekonom&#039; snižte neschopnost o 5%.</para>
                        </popis_dotazu>
                            <sql>Update administrativa A
Set neschopnost_index = neschopnost_index * 0.95
where (Select pozice
       From zamestnanec Z
       Where Z.zamestnanec_key = A.zamestnanec_key) = &#039;Ekonom&#039;;

rollback;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D12">
                        <popis_dotazu>
                                <para>Jména administrativních pracovníků, kteří uživají alespoň jeden vůz určený pro transport pacientů. </para>
                        </popis_dotazu>
                            <relacni_algebra>{ADMINISTRATIVA * ZAMESTNANEC * ADMINISTRATIVA_VUZ_REL * VUZ}(ucel = &#039;transport pacientu&#039;)[JMENO, PRIJMENI]</relacni_algebra>
                            <sql>SELECT DISTINCT JMENO,
                PRIJMENI
FROM
  (SELECT DISTINCT *
   FROM ADMINISTRATIVA
   NATURAL JOIN ZAMESTNANEC
   NATURAL JOIN ADMINISTRATIVA_VUZ_REL
   NATURAL JOIN VUZ)
WHERE ucel = &#039;transport pacientu&#039;;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D13">
                        <popis_dotazu>
                                <para>Vytvořte pohled se seznamem návštěv, u nichž budou podrobnosti o jejich účastnících (pacientech a návštěvníkách). Nad pohledem vypište podrobnosti o návštěvách konaných se počínaje dnešním datem.</para>
                        </popis_dotazu>
                            <sql>create view navsteva_navstevnik as
    select navsteva_key,datum,navstevnik.navstevnik_key,navstevnik.jmeno,navstevnik.prijmeni,pacient_key
    from navsteva natural join navstevnik
    order by navsteva_key,datum;
    
create view navsteva_navstevnik_pacient as
    select navsteva_key,datum,navstevnik_key,navsteva_navstevnik.jmeno as njmeno,navsteva_navstevnik.prijmeni as nprijmeni,navsteva_navstevnik.pacient_key,pacient.jmeno as pjemno,pacient.prijmeni as pprijmeni from navsteva_navstevnik join pacient on navsteva_navstevnik.pacient_key = pacient.pacient_key;
    
alter session set nls_date_format=&#039;dd.mm.yyyy&#039;;

select * from navsteva_navstevnik_pacient order by 1;

select * from navsteva_navstevnik_pacient where (datum &gt; trunc(current_date));

drop view navsteva_navstevnik;
drop view navsteva_navstevnik_pacient;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D14">
                        <popis_dotazu>
                                <para>Návštěvy z roku 2018, kterých se neúčastnil návštěvník Justin Head. </para>
                        </popis_dotazu>
                            <relacni_algebra>{{navsteva(datum&gt;=&#039;1.1.2018&#039; ∧ datum&lt;=&#039;31.12.2018&#039;)}\{navsteva(datum&gt;=&#039;1.1.2018&#039; ∧ datum&lt;=&#039;31.12.2018&#039;)&lt;*navstevnik(jmeno=&#039;Justin&#039; ∧ prijmeni=&#039;Head&#039;)}*navstevnik}[navsteva_key, datum, poznamka, pacient_key, mistnost_key]</relacni_algebra>
                            <sql>SELECT DISTINCT navsteva_key,
                datum,
                poznamka,
                pacient_key,
                mistnost_key
FROM
  (SELECT DISTINCT *
   FROM (
           (SELECT DISTINCT *
            FROM
              (SELECT DISTINCT *
               FROM navsteva
               WHERE datum &gt;= TO_DATE(&#039;1.1.2018&#039;,&#039;dd.mm.yyyy&#039;)
                 AND datum &lt;= TO_DATE(&#039;31.12.2018&#039;,&#039;dd.mm.yyyy&#039;))) MINUS
           (SELECT DISTINCT *
            FROM
              (SELECT DISTINCT NAVSTEVA_KEY, DATUM, POZNAMKA, PACIENT_KEY, MISTNOST_KEY
               FROM
                 (SELECT DISTINCT *
                  FROM navsteva
                  WHERE datum &gt;= TO_DATE(&#039;1.1.2018&#039;,&#039;dd.mm.yyyy&#039;)
                    AND datum &lt;= TO_DATE(&#039;31.12.2018&#039;,&#039;dd.mm.yyyy&#039;))
               NATURAL JOIN
                 (SELECT DISTINCT *
                  FROM navstevnik
                  WHERE jmeno = &#039;Justin&#039;
                    AND prijmeni = &#039;Head&#039;))))
   NATURAL JOIN navstevnik);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D15">
                        <popis_dotazu>
                                <para>Všechny možné kombinace zdravotníků a léčeb.</para>
                        </popis_dotazu>
                            <relacni_algebra>{zamestnanec * zdravotnik × lecba}[zamestnanec_key, osobni_cislo, jmeno, prijmeni, lecba_key, nazev]</relacni_algebra>
                            <sql>SELECT DISTINCT zamestnanec_key,
                osobni_cislo,
                jmeno,
                prijmeni,
                lecba_key,
                nazev
FROM
  (SELECT DISTINCT R1.zamestnanec_key,
                   R1.osobni_cislo,
                   R1.jmeno,
                   R1.prijmeni,
                   R1.pozice,
                   R1.pocatek_pomeru,
                   R1.pocitac_key,
                   R1.specializace,
                   R1.praxe,
                   R1.resurrect_count,
                   R1.death_count,
                   R1.ordinace_mistnost_key,
                   R1.ozdravovna_mistnost_key,
                   R2.LECBA_KEY,
                   R2.NAZEV,
                   R2.DATUM_REALIZACE,
                   R2.KAPACITA,
                   R2.POZNAMKA,
                   R2.ZAMESTNANEC_KEY AS ZAMESTNANEC_KEY_1,
                   R2.MISTNOST_KEY
   FROM
     (SELECT DISTINCT *
      FROM zamestnanec
      NATURAL JOIN zdravotnik) R1
   CROSS JOIN lecba R2);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D16">
                        <popis_dotazu>
                                <para>Vyberte diety, které nemá žádny pacient.</para>
                        </popis_dotazu>
                            <sql>select d.dieta_key,d.cislo,d.poznamka from dieta d left join pacient p on p.dieta_key=d.dieta_key where p.dieta_key is null;

select j.dieta_key,j.cislo,j.poznamka 
from dieta j
  join (select d.dieta_key from dieta d
        minus
        select p.dieta_key from pacient p
       ) m on j.dieta_key=m.dieta_key;

select d.dieta_key,d.cislo,d.poznamka
from dieta d
where d.dieta_key not in (select dieta_key from pacient);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D17">
                        <popis_dotazu>
                                <para>Vyber pacienty a návštěvníky, kteří je navštívili, včetně pacientů, kteří nebyli nikdy navštíveni.</para>
                        </popis_dotazu>
                            <sql>select distinct p.jmeno as pacient_jmeno, p.prijmeni as pacient_prijmeni, n.jmeno as navstevnik_jmeno, n.prijmeni as navstevnik_prijmeni
from pacient p
  full outer join navsteva na on p.pacient_key=na.pacient_key
  left join navstevnik n on n.navsteva_key=na.navsteva_key order by 3,4;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D18">
                        <popis_dotazu>
                                <para>Pacienti, jejichž křestní jméno začíná  na &quot;P&quot; spolu s pacienty,  kteří bydlí na pokoji ve společnosti štenice strahovské.</para>
                        </popis_dotazu>
                            <sql>select p.jmeno, p.prijmeni, pok.poznamka
from pacient p
  join pacientsky_pokoj pok on p.mistnost_key=pok.mistnost_key
where p.jmeno like &#039;P%&#039;  
union
select p.jmeno, p.prijmeni, pok.poznamka
from pacient p
  join pacientsky_pokoj pok on p.mistnost_key=pok.mistnost_key and pok.poznamka=&#039;stenice strahovska&#039; order by 1,2;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D19">
                        <popis_dotazu>
                                <para>Pacienti, kteří bydlí na pokoji &#039;05-Y&#039; a zároveň je ošetřuje zdravotník &#039;Micah Mcknight&#039;.</para>
                        </popis_dotazu>
                            <sql>select pacient_key, pacient.jmeno, pacient.prijmeni from pacientsky_pokoj natural join mistnost natural join pacient where (oznaceni=&#039;05-Y&#039;) 
intersect
select pacient_key, pacient.jmeno, pacient.prijmeni from pacient natural join zdravotnik_pacient_rel join zamestnanec on (zdravotnik_pacient_rel.zamestnanec_key = zamestnanec.zamestnanec_key) where (zamestnanec.jmeno = &#039;Micah&#039; and zamestnanec.prijmeni = &#039;Mcknight&#039;);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D20">
                        <popis_dotazu>
                                <para>Čísla oddělení a počet místností k ním vedených.</para>
                        </popis_dotazu>
                            <sql>select o.cislo, count(1) as pocet
from oddeleni o
  left join mistnost m on m.oddeleni_key=o.oddeleni_key
group by o.oddeleni_key, o.cislo
order by 2 desc;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D21">
                        <popis_dotazu>
                                <para>Vypište počet léčeb s počet procedur počínaje rokem 2018, kde celková bolest u procedur byla větší než 100.</para>
                        </popis_dotazu>
                            <sql>select extract(year from l.datum_realizace) as rok, count(distinct l.lecba_key) as pocet_leceb, count(p.lecba_key) as pocet_procedur, round(sum(p.uroven_bolesti), 0) as bolest
from lecba l
  join procedura p on p.lecba_key=l.lecba_key
where l.datum_realizace&gt;to_date(&#039;01012018&#039;, &#039;DDMMYYYY&#039;)
group by extract(year from l.datum_realizace)
having sum(p.uroven_bolesti)&gt;100
order by bolest desc;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D22">
                        <popis_dotazu>
                                <para>Veškeré přístroje na ozdravovně &#039;25-R&#039; přidejte na ozdravovnu &#039;18-W&#039;.</para>
                        </popis_dotazu>
                            <sql>CREATE SEQUENCE seq_pristroj_key START WITH 101 NOCACHE ORDER ;
insert into pristroj (pristroj_key, oznaceni, nazev, ucel, hrozba_uroven, mistnost_key)
  select seq_pristroj_key.nextval, seq_pristroj_key.nextval, p.nazev, p.ucel, p.hrozba_uroven, (select mistnost.mistnost_key from mistnost join pristroj on pristroj.mistnost_key=mistnost.mistnost_key where mistnost.oznaceni=&#039;25-R&#039;) from pristroj p
    join mistnost m on m.mistnost_key=p.mistnost_key and m.oznaceni=&#039;18-W&#039;;
    
rollback;
drop sequence seq_pristroj_key;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D23">
                        <popis_dotazu>
                                <para>Smažte z tabulky užívání vozou administrativou zaměstnance  &#039;Hammett	Caldwell&#039;.</para>
                        </popis_dotazu>
                            <sql>delete from administrativa_vuz_rel
where zamestnanec_key in (
  select zamestnanec_key from administrativa natural join zamestnanec where jmeno=&#039;Hammett&#039; and prijmeni=&#039;Caldwell&#039;
);

rollback;</sql>
                    </dotaz>
                    <dotaz dotaz_id="D24">
                        <popis_dotazu>
                                <para>Seznam vozů na oddělení 2</para>
                        </popis_dotazu>
                            <relacni_algebra>{oddeleni(oddeleni.cislo=2)[oddeleni_key-&gt;ok1][ok1=ok2]vuz[oddeleni_key-&gt;ok2, spz, nazev]}[spz, nazev]</relacni_algebra>
                            <sql>SELECT DISTINCT spz,
                nazev
FROM
  (SELECT DISTINCT *
   FROM
     (SELECT DISTINCT oddeleni_key AS ok1
      FROM oddeleni
      WHERE oddeleni.cislo = 2)
   JOIN
     (SELECT DISTINCT oddeleni_key AS ok2,
                      spz,
                      nazev
      FROM vuz) ON ok1 = ok2);</sql>
                    </dotaz>
                    <dotaz dotaz_id="D25">
                        <popis_dotazu>
                                <para>Seznam vozu mimo oddělení 2</para>
                        </popis_dotazu>
                            <relacni_algebra>{vuz!&lt;*oddeleni(cislo=1)}[spz,nazev]</relacni_algebra>
                            <sql>SELECT DISTINCT spz,
                nazev
FROM
  (SELECT DISTINCT *
   FROM vuz MINUS SELECT DISTINCT VUZ_KEY,
                                  SPZ,
                                  UCEL,
                                  NAZEV,
                                  ODDELENI_KEY
   FROM vuz
   NATURAL JOIN
     (SELECT DISTINCT *
      FROM oddeleni
      WHERE cislo = 1));</sql>
                    </dotaz>
            </dotazy>
            <pokryti_dotazu>
                        <radek>
                            <kategorie>A</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D6">D6</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D8">D8</link>
                                    <link url="#D10">D10</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D13">D13</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                                    <link url="#D17">D17</link>
                                    <link url="#D18">D18</link>
                                    <link url="#D19">D19</link>
                                    <link url="#D20">D20</link>
                                    <link url="#D21">D21</link>
                                    <link url="#D22">D22</link>
                                    <link url="#D23">D23</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>A - Pozitivní dotaz nad spojením alespoň dvou tabulek</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>AR</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D10">D10</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>A (RA) - Pozitivní dotaz nad spojením alespoň dvou tabulek</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>B</kategorie>
                            <odkazy>
                                    <link url="#D14">D14</link>
                            </odkazy>
                            <kategorie_popis>B - Negativní dotaz nad spojením alespoň dvou tabulek</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>C</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                            </odkazy>
                            <kategorie_popis>C - Vyber ty, kteří mají vztah POUZE k ...</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>D1</kategorie>
                            <odkazy>
                                    <link url="#D5">D5</link>
                                    <link url="#D7">D7</link>
                            </odkazy>
                            <kategorie_popis>D1 - Vyber ty, kteří/které jsou ve vztahu se všemi - dotaz s univerzální kvantifikací</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>D1R</kategorie>
                            <odkazy>
                                    <link url="#D7">D7</link>
                            </odkazy>
                            <kategorie_popis>D1 (RA) - Vyber ty, kteří/které jsou ve vztahu se všemi - dotaz s univerzální kvantifikací</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>D2</kategorie>
                            <odkazy>
                                    <link url="#D8">D8</link>
                            </odkazy>
                            <kategorie_popis>D2 - Kontrola výsledku dotazu z kategorie D1</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F1</kategorie>
                            <odkazy>
                                    <link url="#D10">D10</link>
                                    <link url="#D13">D13</link>
                                    <link url="#D16">D16</link>
                                    <link url="#D18">D18</link>
                                    <link url="#D19">D19</link>
                                    <link url="#D21">D21</link>
                                    <link url="#D22">D22</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>F1 - JOIN ON</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F1R</kategorie>
                            <odkazy>
                                    <link url="#D10">D10</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>F1 (RA) - JOIN ON</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F2</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D5">D5</link>
                                    <link url="#D6">D6</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D8">D8</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D13">D13</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                                    <link url="#D19">D19</link>
                                    <link url="#D23">D23</link>
                            </odkazy>
                            <kategorie_popis>F2 - NATURAL JOIN|JOIN USING</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F2R</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                            </odkazy>
                            <kategorie_popis>F2 (RA) - NATURAL JOIN|JOIN USING</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F3</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D3">D3</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D5">D5</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D15">D15</link>
                            </odkazy>
                            <kategorie_popis>F3 - CROSS JOIN</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F3R</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D3">D3</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D15">D15</link>
                            </odkazy>
                            <kategorie_popis>F3 (RA) - CROSS JOIN</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F4</kategorie>
                            <odkazy>
                                    <link url="#D16">D16</link>
                                    <link url="#D17">D17</link>
                                    <link url="#D20">D20</link>
                            </odkazy>
                            <kategorie_popis>F4 - LEFT|RIGHT OUTER JOIN</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>F5</kategorie>
                            <odkazy>
                                    <link url="#D17">D17</link>
                            </odkazy>
                            <kategorie_popis>F5 - FULL (OUTER) JOIN</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>G1</kategorie>
                            <odkazy>
                                    <link url="#D5">D5</link>
                                    <link url="#D11">D11</link>
                                    <link url="#D16">D16</link>
                                    <link url="#D23">D23</link>
                            </odkazy>
                            <kategorie_popis>G1 - Vnořený dotaz v klauzuli WHERE</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>G2</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D3">D3</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D5">D5</link>
                                    <link url="#D6">D6</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D10">D10</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                                    <link url="#D16">D16</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>G2 - Vnořený dotaz v klauzuli FROM</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>G2R</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D2">D2</link>
                                    <link url="#D3">D3</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D10">D10</link>
                                    <link url="#D12">D12</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D15">D15</link>
                                    <link url="#D24">D24</link>
                            </odkazy>
                            <kategorie_popis>G2 (RA) - Vnořený dotaz v klauzuli FROM</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>G3</kategorie>
                            <odkazy>
                                    <link url="#D6">D6</link>
                                    <link url="#D22">D22</link>
                            </odkazy>
                            <kategorie_popis>G3 - Vnořený dotaz v klauzuli SELECT</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>G4</kategorie>
                            <odkazy>
                                    <link url="#D5">D5</link>
                            </odkazy>
                            <kategorie_popis>G4 - Vztažený vnořený dotaz (EXISTS, NOT EXISTS)</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>H1</kategorie>
                            <odkazy>
                                    <link url="#D18">D18</link>
                            </odkazy>
                            <kategorie_popis>H1 - Množinové sjednocení - UNION</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>H2</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D5">D5</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D8">D8</link>
                                    <link url="#D14">D14</link>
                                    <link url="#D16">D16</link>
                            </odkazy>
                            <kategorie_popis>H2 - Množinový rozdíl - MINUS nebo EXCEPT</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>H2R</kategorie>
                            <odkazy>
                                    <link url="#D1">D1</link>
                                    <link url="#D4">D4</link>
                                    <link url="#D7">D7</link>
                                    <link url="#D14">D14</link>
                            </odkazy>
                            <kategorie_popis>H2 (RA) - Množinový rozdíl - MINUS nebo EXCEPT</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>H3</kategorie>
                            <odkazy>
                                    <link url="#D19">D19</link>
                            </odkazy>
                            <kategorie_popis>H3 - Množinový průnik - INTERSECT</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>I1</kategorie>
                            <odkazy>
                                    <link url="#D6">D6</link>
                                    <link url="#D9">D9</link>
                                    <link url="#D20">D20</link>
                                    <link url="#D21">D21</link>
                            </odkazy>
                            <kategorie_popis>I1 - Agregační funkce (count|sum|min|max|avg)</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>I2</kategorie>
                            <odkazy>
                                    <link url="#D20">D20</link>
                                    <link url="#D21">D21</link>
                            </odkazy>
                            <kategorie_popis>I2 - Agregační funkce nad seskupenými řádky - GROUP BY (HAVING)</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>J</kategorie>
                            <odkazy>
                                    <link url="#D16">D16</link>
                            </odkazy>
                            <kategorie_popis>J - Stejný dotaz ve třech různých formulacích SQL</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>K</kategorie>
                            <odkazy>
                                    <link url="#D21">D21</link>
                            </odkazy>
                            <kategorie_popis>K - Všechny klauzule v 1 dotazu - SELECT FROM WHERE GROUP BY HAVING ORDER BY</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>L</kategorie>
                            <odkazy>
                                    <link url="#D13">D13</link>
                            </odkazy>
                            <kategorie_popis>L - VIEW</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>M</kategorie>
                            <odkazy>
                                    <link url="#D13">D13</link>
                            </odkazy>
                            <kategorie_popis>M - Dotaz nad pohledem</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>N</kategorie>
                            <odkazy>
                                    <link url="#D22">D22</link>
                            </odkazy>
                            <kategorie_popis>N - INSERT, který vloží do některé tabulky množinu řádků, které jsou vybrány dotazem z vybraných tabulek (příkaz INSERT, ve kterém je klauzule VALUES nahrazena vnořeným poddotazem.</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>O</kategorie>
                            <odkazy>
                                    <link url="#D9">D9</link>
                                    <link url="#D11">D11</link>
                            </odkazy>
                            <kategorie_popis>O - UPDATE s vnořeným SELECT příkazem</kategorie_popis>
                        </radek>
                        <radek>
                            <kategorie>P</kategorie>
                            <odkazy>
                                    <link url="#D23">D23</link>
                            </odkazy>
                            <kategorie_popis>P - DELETE s vnořeným SELECT příkazem</kategorie_popis>
                        </radek>
            </pokryti_dotazu>
        </queries>
        <scripts>
            <title>Scripts</title>
            <para>
                <link url="./create.sql">create.sql</link>
            </para>
            <para>
                <link url="./insert.sql">insert.sql</link>
            </para>
        </scripts>
        <conclussions>
            <title>Závěr</title>
                    <para>Díky semestrální práci jsem si zdokonalil množinové operace, vnímání databáze a relací jako takových. Myslím si, že čas strávený na semestrální práci byl rozhodně k něčemu dobrý.</para>
        </conclussions>
        <references>
            <title>Zdroje</title>
                    <para>[1] Stránky předmětu BI-DBS - https://courses.fit.cvut.cz</para>
                    <para></para>
                    <para>[2] Nová verze &quot;vzorové&quot; semestrální práce umístěná na adrese: https://users.fit.cvut.cz/~hunkajir/dbs/main.xml</para>
        </references>
    </content>
</sproject>
